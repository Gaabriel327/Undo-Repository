{% extends "base.html" %}
{% block title %}WeDo · Gruppen{% endblock %}

{% block content %}
<div class="container">

  <div class="card">
    <h1 style="margin-bottom:6px;">WeDo · Gruppen</h1>
  </div>

  <!-- Status -->
  <div class="card">
    <div class="row" style="border-top:none">
      <div class="grow">
        <div class="title">Dein Gruppen-Status</div>
        <div class="muted">
          {% set total = (groups|length) %}
          {% if total == 0 %}
            Du bist derzeit in keiner Gruppe.
          {% elif total == 1 %}
            Du bist in 1 Gruppe.
          {% else %}
            Du bist in {{ total }} Gruppen.
          {% endif %}
          {% if own_count is defined %}
            &nbsp;·&nbsp;Eigene Gruppen: {{ own_count }}{% if not can_create %} (Limit 3 erreicht){% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Liste -->
  {% if groups and (groups|length) > 0 %}
    <div class="card">
      {% for g in groups %}
        <div class="row">
          <div class="grow">
            <div class="title">{{ g.name }}</div>
            <div class="muted">
              {% if user and (user.id|string) == (g.created_by or '') %}
                Rolle: Owner
              {% else %}
                Rolle: Member
              {% endif %}
            </div>
          </div>
          <div class="action" style="display:flex; gap:8px; flex-wrap:wrap;">
            <a class="btn" href="{{ url_for('group_overview', group_id=g.id) }}">Öffnen</a>
            {% if user and (user.id|string) == (g.created_by or '') %}
              <a class="btn ghost" href="{{ url_for('group_edit', group_id=g.id) }}">Bearbeiten</a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="card">
      <div class="row" style="border-top:none">
        <div class="grow">
          <div class="title">Noch keine Gruppen</div>
          <div class="muted">Erstelle eine Gruppe und lade andere ein.</div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Neue Gruppe -->
  <div class="card">
    {% if can_create %}
      <form method="post" action="{{ url_for('create_group') }}">
        <div class="row" style="border-top:none;">
          <div class="grow">
            <label for="gname" class="title" style="display:block; margin-bottom:8px;">Neue Gruppe</label>
            <input id="gname" name="name" type="text" placeholder="Name der Gruppe" />
            <div class="muted" style="margin-top:6px;">Max. 3 eigene Gruppen möglich.</div>
          </div>
          <div class="action">
            <button class="btn" type="submit">Erstellen</button>
          </div>
        </div>
      </form>
    {% else %}
      <div class="row" style="border-top:none;">
        <div class="grow">
          <div class="title">Limit erreicht</div>
          <div class="muted">Du kannst maximal 3 eigene Gruppen erstellen.</div>
        </div>
      </div>
    {% endif %}
  </div>

</div>
{% endblock %}