{% extends "base.html" %}
{% block title %}WeDo – Übersicht{% endblock %}

{% block content %}
  <div class="card" style="max-width:740px;margin:0 auto">
    <div class="row" style="border-top:none">
      <div class="grow">
        <div class="title">{{ group.name }}</div>
        <div class="muted">Gemeinsamer Überblick & Today’s WeDo</div>
      </div>
      <a class="btn ghost" href="{{ url_for('groups_list') }}">← Zurück zu WeDo</a>
    </div>

    <div style="text-align:center;margin:14px 0">
      <img src="{{ radar_url }}" alt="Gruppenfortschritt" style="max-width:100%;border-radius:12px;">
    </div>

    <div class="row" style="align-items:center;">
      <div class="grow">
        <div class="title">Today’s WeDo</div>
        {% if already_today %}
          <div class="muted">Heute bereits beantwortet.</div>
        {% endif %}
      </div>
      <div class="action" style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;">
        {% set invite = url_for('group_join', group_id=group.id, _external=True) %}
        <button class="btn ghost" type="button" onclick="shareInvite('{{ invite }}')">Mitglieder einladen</button>

        {% if already_today %}
          <a class="btn" href="{{ url_for('group_prompt', group_id=group.id, extra=1) }}">Extra-Frage (1 Token)</a>
        {% else %}
          <a class="btn" href="{{ url_for('group_prompt', group_id=group.id) }}">Heute beantworten</a>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  async function shareInvite(link) {
    try {
      if (navigator.share) {
        await navigator.share({
          title: 'Komm in meine UNDO Gruppe!',
          text: 'Hier ist dein Einladungslink:',
          url: link
        });
        return;
      }
    } catch (e) {
      console.warn('Native Share-API nicht verfügbar:', e);
    }
    try {
      await navigator.clipboard.writeText(link);
      alert('Einladungslink wurde in die Zwischenablage kopiert:\n' + link);
    } catch (e) {
      prompt('Teilen wird nicht unterstützt – kopiere den Link:', link);
    }
  }
</script>
{% endblock %}